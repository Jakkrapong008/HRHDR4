<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏á‡∏î‡∏á‡∏£‡∏±‡∏ê‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
        * {
            font-family: 'Prompt', sans-serif;
        }
        
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å */
        :root {
            --primary: #ff6b6b;
            --primary-light: #ffb8b8;
            --primary-dark: #d14747;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --gray: #e9ecef;
            
            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ */
            --dept-color-1: #3498db; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ */
            --dept-color-2: #2ecc71; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì */
            --dept-color-3: #9b59b6; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• */
            --dept-color-4: #f39c12; /* ‡∏™‡∏µ‡∏™‡πâ‡∏° - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
            --dept-color-5: #1abc9c; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô */
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á body */
        body {
            background-color: var(--light-gray);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
        .calendar-container {
            background-color: var(--white);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
        .calendar-header {
            background-color: var(--primary);
            color: var(--white);
            border-radius: 1rem 1rem 0 0;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
        .calendar-day {
            min-height: 100px;
            transition: all 0.3s ease;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ß‡∏±‡∏ô */
        .calendar-day:hover {
            background-color: var(--light-gray);
            transform: translateY(-2px);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° */
        .calendar-day.has-event {
            background-color: var(--primary-light);
            color: var(--primary-dark);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å */
        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
            transition: all 0.3s ease;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å */
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏ö */
        .btn-outline {
            border: 1px solid var(--primary);
            color: var(--primary);
            transition: all 0.3s ease;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏ö */
        .btn-outline:hover {
            background-color: var(--primary-light);
            color: var(--primary-dark);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° */
        .event-item {
            transition: all 0.3s ease;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ö‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° */
        .event-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô fade-in */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô bounce */
        .bounce {
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-5px);
            }
        }
        
        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô pulse */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà */
        .tab-active {
            background-color: var(--primary);
            color: var(--white);
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÇ‡∏´‡∏•‡∏î */
        .loader {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .dept-color-1 {
            color: var(--dept-color-1) !important;
        }
        
        .dept-color-2 {
            color: var(--dept-color-2) !important;
        }
        
        .dept-color-3 {
            color: var(--dept-color-3) !important;
        }
        
        .dept-color-4 {
            color: var(--dept-color-4) !important;
        }
        
        .dept-color-5 {
            color: var(--dept-color-5) !important;
        }
        
        /* ‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .border-dept-1 {
            border-left-color: var(--dept-color-1) !important;
        }
        
        .border-dept-2 {
            border-left-color: var(--dept-color-2) !important;
        }
        
        .border-dept-3 {
            border-left-color: var(--dept-color-3) !important;
        }
        
        .border-dept-4 {
            border-left-color: var(--dept-color-4) !important;
        }
        
        .border-dept-5 {
            border-left-color: var(--dept-color-5) !important;
        }
        
        /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .bg-dept-1 {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .bg-dept-2 {
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        .bg-dept-3 {
            background-color: rgba(155, 89, 182, 0.1);
        }
        
        .bg-dept-4 {
            background-color: rgba(243, 156, 18, 0.1);
        }
        
        .bg-dept-5 {
            background-color: rgba(26, 188, 156, 0.1);
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 fade-in">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://img2.pic.in.th/pic/logo-HDR.png" alt="School Logo" class="h-12 w-12 mr-4" onerror="this.onerror=null;this.src='https://placehold.co/48x48/cccccc/000000?text=Logo';">
                
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                    <h2 class="text-lg md:text-xl text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏á‡∏î‡∏á‡∏£‡∏±‡∏ê‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå üìö</h2>
                </div>
            </div>
            <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                <button id="refreshBtn" class="btn-primary px-4 py-2 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </header>

        <div class="bg-white rounded-lg shadow-md p-4 mb-6 fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex space-x-2 mb-4 md:mb-0">
                    <button id="monthViewBtn" class="tab-active px-4 py-2 rounded-lg">
                        <span class="mr-1">üìÖ</span> ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </button>
                    <button id="yearViewBtn" class="btn-outline px-4 py-2 rounded-lg">
                        <span class="mr-1">üìÜ</span> ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                    </button>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button id="prevBtn" class="btn-outline p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h2 id="currentPeriod" class="text-xl font-semibold px-4"></h2>
                    <button id="nextBtn" class="btn-outline p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-4 mb-6 fade-in">
            <h3 class="text-lg font-semibold mb-3">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                    <input type="text" id="titleFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-300" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</label>
                    <select id="personFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-300">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô</label>
                    <select id="departmentFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-300">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="searchBtn" class="btn-primary px-4 py-2 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>

        <div id="loadingIndicator" class="flex justify-center items-center py-10 hidden">
            <div class="loader mr-3"></div>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <div id="calendarView" class="calendar-container mb-6 fade-in">
            <div class="calendar-header p-4">
                <div class="grid grid-cols-7 text-center font-semibold">
                    <div>‡∏≠‡∏≤</div>
                    <div>‡∏à</div>
                    <div>‡∏≠</div>
                    <div>‡∏û</div>
                    <div>‡∏û‡∏§</div>
                    <div>‡∏®</div>
                    <div>‡∏™</div>
                </div>
            </div>
            <div id="calendarDays" class="grid grid-cols-7 p-2">
                </div>
        </div>

        <div id="yearView" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6 hidden fade-in">
            </div>

        <div class="bg-white rounded-lg shadow-md p-4 mb-6 fade-in">
            <h3 class="text-lg font-semibold mb-3">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
            <div id="eventsList" class="space-y-3">
                </div>
        </div>

        <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full mx-4 fade-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold" id="modalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="modalContent" class="space-y-3">
                    </div>
                <div class="mt-6 flex justify-end">
                    <button id="closeModalBtn" class="btn-outline px-4 py-2 rounded-lg">‡∏õ‡∏¥‡∏î</button>
                </div>
            </div>
        </div>

        <footer class="text-center text-gray-500 text-sm mt-8 fade-in">
            <p>¬© 2025 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏á‡∏î‡∏á‡∏£‡∏±‡∏ê‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
        </footer>
    </div>

    <script>
        // Global variables
        let allEvents = [];
        let filteredEvents = []; // Events filtered by responsible person (student/teacher and student)
        let currentDate = new Date();
        let currentView = 'month';
        // Google Sheet ID and Sheet Name
        const SHEET_ID = '1vMfGpLQc-Iu7O3JGkGXuzlZf0AXEQWv4fX7YOFbHA1E';
        const SHEET_NAME = '68';
        // API URL for Google Apps Script
        const API_URL = 'https://script.google.com/macros/s/AKfycbz9j_keDQjuL2wcYnJVJhAEYE6tKmVeWVwHsb5mE_o5MoN1f_Mot3LDLACnAmR-uvEmGg/exec';
        
        // Define departments and their associated colors
        const departments = {
            "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£": { // Reverted to original keys from index-st-2.txt
                colorClass: "dept-color-1",
                bgClass: "bg-dept-1",
                borderClass: "border-dept-1"
            },
            "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì": { // Reverted to original keys from index-st-2.txt
                colorClass: "dept-color-2",
                bgClass: "bg-dept-2",
                borderClass: "border-dept-2"
            },
            "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•": { // Reverted to original keys from index-st-2.txt
                colorClass: "dept-color-3",
                bgClass: "bg-dept-3",
                borderClass: "border-dept-3"
            },
            "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ": { // Reverted to original keys from index-st-2.txt
                colorClass: "dept-color-4",
                bgClass: "bg-dept-4",
                borderClass: "border-dept-4"
            },
            "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£": { // Reverted to original keys from index-st-2.txt
                colorClass: "dept-color-5",
                bgClass: "bg-dept-5",
                borderClass: "border-dept-5"
            }
        };
        
        // Reference to DOM elements
        const monthViewBtn = document.getElementById('monthViewBtn');
        const yearViewBtn = document.getElementById('yearViewBtn');
        const calendarView = document.getElementById('calendarView');
        const yearView = document.getElementById('yearView');
        const calendarDays = document.getElementById('calendarDays');
        const currentPeriod = document.getElementById('currentPeriod');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const eventsList = document.getElementById('eventsList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const refreshBtn = document.getElementById('refreshBtn');
        const searchBtn = document.getElementById('searchBtn');
        const titleFilter = document.getElementById('titleFilter');
        const personFilter = document.getElementById('personFilter');
        const departmentFilter = document.getElementById('departmentFilter');
        const eventModal = document.getElementById('eventModal');
        const closeModal = document.getElementById('closeModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalContent = document.getElementById('modalContent');
        
        // Thai month names
        const thaiMonths = [
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
        ];
        
        // Initialize the app
        function init() {
            fetchEvents();
            setupEventListeners();
            updateCalendarTitle();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            monthViewBtn.addEventListener('click', () => switchView('month'));
            yearViewBtn.addEventListener('click', () => switchView('year'));
            prevBtn.addEventListener('click', navigatePrevious);
            nextBtn.addEventListener('click', navigateNext);
            refreshBtn.addEventListener('click', fetchEvents);
            searchBtn.addEventListener('click', filterEvents); // Call filterEvents on search
            closeModal.addEventListener('click', hideModal);
            closeModalBtn.addEventListener('click', hideModal);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === eventModal) {
                    hideModal();
                }
            });
            
            // Add event listener for Enter key in search input
            titleFilter.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    filterEvents();
                }
            });
        }
        
        // Switch between month and year view
        function switchView(view) {
            currentView = view;
            
            if (view === 'month') {
                monthViewBtn.classList.add('tab-active');
                monthViewBtn.classList.remove('btn-outline');
                yearViewBtn.classList.remove('tab-active');
                yearViewBtn.classList.add('btn-outline');
                calendarView.classList.remove('hidden');
                yearView.classList.add('hidden');
            } else {
                yearViewBtn.classList.add('tab-active');
                yearViewBtn.classList.remove('btn-outline');
                monthViewBtn.classList.remove('tab-active');
                monthViewBtn.classList.add('btn-outline');
                calendarView.classList.add('hidden');
                yearView.classList.remove('hidden');
            }
            
            updateCalendarTitle();
            filterEvents(); // Call filterEvents to update display for new view
        }
        
        // Update calendar title based on current view and date
        function updateCalendarTitle() {
            if (currentView === 'month') {
                currentPeriod.textContent = `${thaiMonths[currentDate.getMonth()]} ${currentDate.getFullYear() + 543}`;
            } else {
                currentPeriod.textContent = `‡∏õ‡∏µ ${currentDate.getFullYear() + 543}`;
            }
        }
        
        // Navigate to previous month/year
        function navigatePrevious() {
            if (currentView === 'month') {
                currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            } else {
                currentDate = new Date(currentDate.getFullYear() - 1, 0, 1);
            }
            updateCalendarTitle();
            filterEvents(); // Call filterEvents to update display
        }
        
        // Navigate to next month/year
        function navigateNext() {
            if (currentView === 'month') {
                currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
            } else {
                currentDate = new Date(currentDate.getFullYear() + 1, 0, 1);
            }
            updateCalendarTitle();
            filterEvents(); // Call filterEvents to update display
        }
        
        // Function to get department styles
        function getDepartmentStyles(department) {
            return departments[department] || {
                colorClass: "dept-color-1", // Default (blue) if department not found
                bgClass: "bg-dept-1",
                borderClass: "border-dept-1"
            };
        }
        
        // Function to check if responsible person is student or teacher and student
        function isStudentResponsible(person) {
            if (!person) return false;
            
            // Check if "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" or "‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" is present
            const personLower = person.toLowerCase();
            return personLower.includes('‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô') || 
                  (personLower.includes('‡∏Ñ‡∏£‡∏π') && personLower.includes('‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'));
        }
        
        // Fetch events from Google Sheets
        function fetchEvents() {
            showLoading(true);
            
            fetch(`${API_URL}?sheetId=${SHEET_ID}&sheetName=${SHEET_NAME}`)
                .then(response => response.json())
                .then(data => {
                    // Process all data
                    allEvents = processEvents(data);
                    
                    // Filter events where responsible person is student or teacher and student
                    filteredEvents = allEvents.filter(event => isStudentResponsible(event.person));
                    
                    populateFilters();
                    filterEvents(); // Call filterEvents to render initial display
                    showLoading(false);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    showLoading(false);
                    // Use custom modal instead of alert
                    showCustomAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                });
        }
        
        // Process event data from API
        function processEvents(data) {
            return data.map(item => {
                // Process all fields from the sheet
                const startDate = parseDate(item['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô']);
                const endDate = item['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î'] ? parseDate(item['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î']) : startDate;
                const department = item['‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô'] ? String(item['‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô']).trim() : ''; // Add .trim()
                const deptStyles = getDepartmentStyles(department);
                
                return {
                    id: item.id || generateId(),
                    title: item['‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                    startDate: startDate,
                    endDate: endDate,
                    time: item['‡πÄ‡∏ß‡∏•‡∏≤'] || '',
                    location: item['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'] || '',
                    department: department,
                    person: item['‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö'] || '',
                    details: item['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'] || '',
                    additionalInfo: item['‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'] || '',
                    colorClass: deptStyles.colorClass,
                    bgClass: deptStyles.bgClass,
                    borderClass: deptStyles.borderClass
                };
            }).filter(event => event.startDate); // Filter out events without valid dates
        }
        
        // Convert date string to Date object
        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            // Try different date formats
            const formats = [
                // DD/MM/YYYY
                str => {
                    const parts = str.split('/');
                    if (parts.length === 3) {
                        return new Date(parts[2], parts[1] - 1, parts[0]);
                    }
                    return null;
                },
                // YYYY-MM-DD
                str => {
                    const parts = str.split('-');
                    if (parts.length === 3) {
                        return new Date(parts[0], parts[1] - 1, parts[2]);
                    }
                    return null;
                },
                // MM/DD/YYYY
                str => {
                    const parts = str.split('/');
                    if (parts.length === 3) {
                        return new Date(parts[2], parts[0] - 1, parts[1]);
                    }
                    return null;
                }
            ];
            
            for (const format of formats) {
                const date = format(dateStr);
                if (date && !isNaN(date.getTime())) {
                    return date;
                }
            }
            
            // If unsuccessful, try native date parsing
            const date = new Date(dateStr);
            return !isNaN(date.getTime()) ? date : null;
        }
        
        // Generate random ID
        function generateId() {
            return Math.random().toString(36).substring(2, 15);
        }
        
        // Populate filter dropdowns
        function populateFilters() {
            // Clear existing options except the first one
            personFilter.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            departmentFilter.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            
            // Get unique values from filtered events only
            const persons = [...new Set(filteredEvents.map(event => event.person).filter(Boolean))];
            const departmentNames = [...new Set(filteredEvents.map(event => event.department).filter(Boolean))];
            
            // Add options to dropdowns
            persons.forEach(person => {
                const option = document.createElement('option');
                option.value = person;
                option.textContent = person;
                personFilter.appendChild(option);
            });
            
            departmentNames.forEach(department => {
                const option = document.createElement('option');
                option.value = department;
                option.textContent = department;
                departmentFilter.appendChild(option);
            });
        }
        
        // Filter events based on search criteria and update display
        function filterEvents() {
            const title = titleFilter.value.toLowerCase();
            const person = personFilter.value;
            const department = departmentFilter.value;
            
            // Filter all events based on search filters
            let searchFilteredEvents = filteredEvents.filter(event => {
                const matchesTitle = title ? event.title.toLowerCase().includes(title) : true;
                const matchesPerson = person ? (event.person && event.person.includes(person)) : true;
                const matchesDepartment = department ? (event.department && event.department.includes(department)) : true;
                return matchesTitle && matchesPerson && matchesDepartment;
            });
            
            // Filter events based on current display period (month or year)
            let eventsToDisplay = [];
            if (currentView === 'month') {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                eventsToDisplay = searchFilteredEvents.filter(event => {
                    const eventStart = new Date(event.startDate);
                    const eventEnd = new Date(event.endDate);
                    // Check if event is within the current month
                    // Events starting or ending in that month, or spanning across that month
                    return (eventStart.getFullYear() === year && eventStart.getMonth() === month) ||
                           (eventEnd.getFullYear() === year && eventEnd.getMonth() === month) ||
                           (eventStart < new Date(year, month, 1) && eventEnd > new Date(year, month + 1, 0));
                });
                renderMonthCalendar(eventsToDisplay);
            } else { // currentView === 'year'
                const year = currentDate.getFullYear();
                eventsToDisplay = searchFilteredEvents.filter(event => {
                    const eventStart = new Date(event.startDate);
                    const eventEnd = new Date(event.endDate);
                    // Check if event is within the current year
                    return (eventStart.getFullYear() === year) || (eventEnd.getFullYear() === year);
                });
                renderYearCalendar(eventsToDisplay);
            }
            
            renderEventsList(eventsToDisplay); // Display the filtered event list
        }
        
        // Display month calendar
        function renderMonthCalendar(eventsToDisplay) {
            calendarDays.innerHTML = '';
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Get the first day of the month
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Get the day of the week for the first day (0 = Sunday, 6 = Saturday)
            let firstDayOfWeek = firstDay.getDay();
            
            // Create empty cells for days before the first day of the month
            for (let i = 0; i < firstDayOfWeek; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day p-2 border border-gray-100';
                calendarDays.appendChild(dayCell);
            }
            
            // Create cells for each day of the month
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const dayEvents = eventsToDisplay.filter(event => {
                    const eventStart = new Date(event.startDate);
                    const eventEnd = new Date(event.endDate);
                    return date >= new Date(eventStart.setHours(0,0,0,0)) && 
                           date <= new Date(eventEnd.setHours(23,59,59,999));
                });
                
                const dayCell = document.createElement('div');
                dayCell.className = `calendar-day p-2 border border-gray-100 ${dayEvents.length > 0 ? 'has-event' : ''}`;
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'flex justify-between items-center mb-1';
                
                const dayNumber = document.createElement('span');
                dayNumber.className = 'font-semibold';
                dayNumber.textContent = day;
                
                const eventCount = document.createElement('span');
                if (dayEvents.length > 0) {
                    eventCount.className = 'text-xs bg-red-500 text-white rounded-full px-2 py-0.5';
                    eventCount.textContent = dayEvents.length;
                }
                
                dayHeader.appendChild(dayNumber);
                if (dayEvents.length > 0) {
                    dayHeader.appendChild(eventCount);
                }
                dayCell.appendChild(dayHeader);
                
                // Add event indicators
                if (dayEvents.length > 0) {
                    const eventsListContainer = document.createElement('div');
                    eventsListContainer.className = 'space-y-1 mt-1';
                    
                    // Display up to 2 events, then show "more" indicator
                    const displayEvents = dayEvents.slice(0, 2);
                    displayEvents.forEach(event => {
                        const eventItem = document.createElement('div');
                        // Use flexbox to align color dot and event title
                        eventItem.className = `flex items-center space-x-1 text-xs truncate cursor-pointer hover:font-semibold`;
                        eventItem.addEventListener('click', () => showEventDetails(event));

                        // Small color dot (now black)
                        const colorDot = document.createElement('div');
                        colorDot.className = `w-2 h-2 rounded-full bg-black`; // All dots are black
                        eventItem.appendChild(colorDot);

                        // Event title
                        const eventTitleSpan = document.createElement('span');
                        eventTitleSpan.className = `${event.colorClass}`; // Text color still based on department
                        eventTitleSpan.textContent = event.title;
                        eventItem.appendChild(eventTitleSpan);

                        eventsListContainer.appendChild(eventItem);
                    });
                    
                    if (dayEvents.length > 2) {
                        const moreIndicator = document.createElement('div');
                        moreIndicator.className = 'text-xs text-center text-gray-500 cursor-pointer hover:underline';
                        moreIndicator.textContent = `+ ‡∏≠‡∏µ‡∏Å ${dayEvents.length - 2} ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°`;
                        moreIndicator.addEventListener('click', () => {
                            // Filter event list to show only events for this day
                            renderEventsList(dayEvents);
                        });
                        eventsListContainer.appendChild(moreIndicator);
                    }
                    
                    dayCell.appendChild(eventsListContainer);
                }
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        // Display year calendar
        function renderYearCalendar(eventsToDisplay) {
            yearView.innerHTML = '';
            
            const year = currentDate.getFullYear();
            
            // Create mini calendar for each month
            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.className = 'bg-white rounded-lg shadow-sm p-3 fade-in';
                
                const monthHeader = document.createElement('div');
                monthHeader.className = 'text-center font-semibold mb-2 text-red-500'; 
                monthHeader.textContent = thaiMonths[month];
                monthContainer.appendChild(monthHeader);
                
                // Create mini calendar grid
                const calendarGrid = document.createElement('div');
                calendarGrid.className = 'grid grid-cols-7 gap-1 text-center text-xs';
                
                // Add day headers
                const dayHeaders = ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
                dayHeaders.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'text-gray-500';
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });
                
                // Get the first day of the month
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const firstDayOfWeek = firstDay.getDay();
                
                // Add empty cells for days before the first day
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    calendarGrid.appendChild(emptyCell);
                }
                
                // Add cells for each day
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const date = new Date(year, month, day);
                    const dayEvents = eventsToDisplay.filter(event => {
                        const eventStart = new Date(event.startDate);
                        const eventEnd = new Date(event.endDate);
                        return date >= new Date(eventStart.setHours(0,0,0,0)) && 
                               date <= new Date(eventEnd.setHours(23,59,59,999));
                    });
                    
                    const dayCell = document.createElement('div');
                    // Set background color of day in year view if there are events
                    dayCell.className = `py-1 cursor-pointer ${dayEvents.length > 0 ? (dayEvents[0].bgClass + ' rounded-full font-semibold') : ''}`; 
                    dayCell.textContent = day;
                    // Set text color of day in year view if there are events
                    if (dayEvents.length > 0) {
                        dayCell.classList.add(dayEvents[0].colorClass);
                    }
                    
                    if (dayEvents.length > 0) {
                        dayCell.addEventListener('click', () => {
                            // Set current date to this day and switch to month view
                            currentDate = new Date(year, month, day);
                            switchView('month');
                        });
                    }
                    
                    calendarGrid.appendChild(dayCell);
                }
                
                monthContainer.appendChild(calendarGrid);
                
                // Count events for this month
                const monthEvents = eventsToDisplay.filter(event => {
                    const eventDate = new Date(event.startDate);
                    return eventDate.getMonth() === month && eventDate.getFullYear() === year;
                });
                
                if (monthEvents.length > 0) {
                    const eventCount = document.createElement('div');
                    eventCount.className = 'text-center text-xs mt-2 text-red-500'; 
                    eventCount.textContent = `${monthEvents.length} ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°`;
                    monthContainer.appendChild(eventCount);
                }
                
                yearView.appendChild(monthContainer);
            }
        }
        
        // Display event list
        function renderEventsList(events) { // Receives already filtered events
            eventsList.innerHTML = '';
            
            if (events.length === 0) {
                const noEvents = document.createElement('div');
                noEvents.className = 'text-center text-gray-500 py-4';
                noEvents.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
                eventsList.appendChild(noEvents);
                return;
            }
            
            // Sort events by date
            const sortedEvents = [...events].sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            // Group events by month
            const eventsByMonth = {};
            sortedEvents.forEach(event => {
                const date = new Date(event.startDate);
                const monthYear = `${thaiMonths[date.getMonth()]} ${date.getFullYear() + 543}`;
                
                if (!eventsByMonth[monthYear]) {
                    eventsByMonth[monthYear] = [];
                }
                
                eventsByMonth[monthYear].push(event);
            });
            
            // Create event list by month
            Object.keys(eventsByMonth).forEach(monthYear => {
                const monthHeader = document.createElement('h4');
                monthHeader.className = 'font-semibold text-red-500 mb-2'; // Month header remains primary red
                monthHeader.textContent = monthYear;
                eventsList.appendChild(monthHeader);
                
                const monthEvents = eventsByMonth[monthYear];
                monthEvents.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = `event-item bg-white p-3 rounded-lg shadow-sm mb-3 ${event.bgClass}`;
                    eventItem.style.borderLeft = `4px solid`;
                    eventItem.classList.add(event.borderClass);
                    eventItem.addEventListener('click', () => showEventDetails(event));
                    
                    const eventHeader = document.createElement('div');
                    eventHeader.className = 'flex justify-between items-start';
                    
                    const eventTitle = document.createElement('h5');
                    eventTitle.className = `font-semibold ${event.colorClass}`; // Event title uses department color
                    eventTitle.textContent = event.title;
                    
                    const eventDate = document.createElement('div');
                    eventDate.className = 'text-sm text-gray-500';
                    
                    const startDate = new Date(event.startDate);
                    const formattedStartDate = `${startDate.getDate()} ${thaiMonths[startDate.getMonth()]} ${startDate.getFullYear() + 543}`;
                    
                    if (event.endDate && event.startDate.toDateString() !== event.endDate.toDateString()) {
                        const endDate = new Date(event.endDate);
                        const formattedEndDate = `${endDate.getDate()} ${thaiMonths[endDate.getMonth()]} ${endDate.getFullYear() + 543}`;
                        eventDate.textContent = `${formattedStartDate} - ${formattedEndDate}`;
                    } else {
                        eventDate.textContent = formattedStartDate;
                    }
                    
                    eventHeader.appendChild(eventTitle);
                    eventHeader.appendChild(eventDate);
                    eventItem.appendChild(eventHeader);
                    
                    if (event.department || event.person) {
                        const eventInfo = document.createElement('div');
                        eventInfo.className = 'text-sm mt-1';
                        
                        if (event.department) {
                            const deptSpan = document.createElement('span');
                            deptSpan.className = `mr-2 ${event.colorClass} font-medium`; // Department name uses department color
                            deptSpan.textContent = `${event.department}`;
                            eventInfo.appendChild(deptSpan);
                        }
                        
                        if (event.person) {
                            const personSpan = document.createElement('span');
                            personSpan.className = 'text-gray-600';
                            personSpan.textContent = `üë§ ${event.person}`;
                            eventInfo.appendChild(personSpan);
                        }
                        
                        eventItem.appendChild(eventInfo);
                    }
                    
                    eventsList.appendChild(eventItem);
                });
            });
        }
        
        // Show event details in modal
        function showEventDetails(event) {
            modalContent.innerHTML = '';
            
            // Event title with department color
            const title = document.createElement('h3');
            title.className = `text-xl font-semibold mb-3 ${event.colorClass}`;
            title.textContent = event.title;
            modalContent.appendChild(title);
            
            // Department badge
            if (event.department) {
                const deptBadge = document.createElement('div');
                deptBadge.className = `inline-block px-3 py-1 rounded-full mb-3 ${event.bgClass} ${event.colorClass} font-medium`;
                deptBadge.textContent = event.department;
                modalContent.appendChild(deptBadge);
            }
            
            // Event start date
            const startDateContainer = document.createElement('div');
            startDateContainer.className = 'flex items-start mb-3';
            
            const startDateIcon = document.createElement('div');
            startDateIcon.className = `mr-2 ${event.colorClass}`;
            startDateIcon.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            `;
            
            const startDateLabel = document.createElement('div');
            startDateLabel.className = 'font-medium mr-2';
            startDateLabel.textContent = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:';
            
            const startDateText = document.createElement('div');
            const startDate = new Date(event.startDate);
            startDateText.textContent = `${startDate.getDate()} ${thaiMonths[startDate.getMonth()]} ${startDate.getFullYear() + 543}`;
            
            startDateContainer.appendChild(startDateIcon);
            startDateContainer.appendChild(startDateLabel);
            startDateContainer.appendChild(startDateText);
            modalContent.appendChild(startDateContainer);
            
            // Event end date
            if (event.endDate && event.startDate.toDateString() !== event.endDate.toDateString()) {
                const endDateContainer = document.createElement('div');
                endDateContainer.className = 'flex items-start mb-3';
                
                const endDateIcon = document.createElement('div');
                endDateIcon.className = `mr-2 ${event.colorClass}`;
                endDateIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                `;
                
                const endDateLabel = document.createElement('div');
                endDateLabel.className = 'font-medium mr-2';
                endDateLabel.textContent = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:';
                
                const endDateText = document.createElement('div');
                const endDate = new Date(event.endDate);
                endDateText.textContent = `${endDate.getDate()} ${thaiMonths[endDate.getMonth()]} ${endDate.getFullYear() + 543}`;
                
                endDateContainer.appendChild(endDateIcon);
                endDateContainer.appendChild(endDateLabel);
                endDateContainer.appendChild(endDateText);
                modalContent.appendChild(endDateContainer);
            }
            
            // Event time
            if (event.time) {
                const timeContainer = document.createElement('div');
                timeContainer.className = 'flex items-start mb-3';
                
                const timeIcon = document.createElement('div');
                timeIcon.className = `mr-2 ${event.colorClass}`;
                timeIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                `;
                
                const timeLabel = document.createElement('div');
                timeLabel.className = 'font-medium mr-2';
                timeLabel.textContent = '‡πÄ‡∏ß‡∏•‡∏≤:';
                
                const timeText = document.createElement('div');
                timeText.textContent = event.time;
                
                timeContainer.appendChild(timeIcon);
                timeContainer.appendChild(timeLabel);
                timeContainer.appendChild(timeText);
                modalContent.appendChild(timeContainer);
            }
            
            // Event location
            if (event.location) {
                const locationContainer = document.createElement('div');
                locationContainer.className = 'flex items-start mb-3';
                
                const locationIcon = document.createElement('div');
                locationIcon.className = `mr-2 ${event.colorClass}`;
                locationIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                `;
                
                const locationLabel = document.createElement('div');
                locationLabel.className = 'font-medium mr-2';
                locationLabel.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:';
                
                const locationText = document.createElement('div');
                locationText.textContent = event.location;
                
                locationContainer.appendChild(locationIcon);
                locationContainer.appendChild(locationLabel);
                locationContainer.appendChild(locationText);
                modalContent.appendChild(locationContainer);
            }
            
            // Responsible person
            if (event.person) {
                const personContainer = document.createElement('div');
                personContainer.className = 'flex items-start mb-3';
                
                const personIcon = document.createElement('div');
                personIcon.className = `mr-2 ${event.colorClass}`;
                personIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                `;
                
                const personLabel = document.createElement('div');
                personLabel.className = 'font-medium mr-2';
                personLabel.textContent = '‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:';
                
                const personText = document.createElement('div');
                personText.textContent = event.person;
                
                personContainer.appendChild(personIcon);
                personContainer.appendChild(personLabel);
                personContainer.appendChild(personText);
                modalContent.appendChild(personContainer);
            }
            
            // Event details
            if (event.details) {
                const detailsContainer = document.createElement('div');
                detailsContainer.className = `mt-4 p-3 ${event.bgClass} rounded-lg`;
                
                const detailsTitle = document.createElement('h4');
                detailsTitle.className = `font-semibold mb-2 ${event.colorClass}`;
                detailsTitle.textContent = '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°';
                
                const detailsText = document.createElement('p');
                detailsText.className = 'text-sm';
                detailsText.textContent = event.details;
                
                detailsContainer.appendChild(detailsTitle);
                detailsContainer.appendChild(detailsText);
                modalContent.appendChild(detailsContainer);
            }
            
            // Additional info
            if (event.additionalInfo) {
                const additionalContainer = document.createElement('div');
                additionalContainer.className = `mt-4 p-3 ${event.bgClass} rounded-lg`;
                
                const additionalTitle = document.createElement('h4');
                additionalTitle.className = `font-semibold mb-2 ${event.colorClass}`;
                additionalTitle.textContent = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';
                
                const additionalText = document.createElement('p');
                additionalText.className = 'text-sm';
                additionalText.textContent = event.additionalInfo;
                
                additionalContainer.appendChild(additionalTitle);
                additionalContainer.appendChild(additionalText);
                modalContent.appendChild(additionalContainer);
            }
            
            eventModal.classList.remove('hidden');
        }
        
        // Hide event details modal
        function hideModal() {
            eventModal.classList.add('hidden');
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            if (show) {
                loadingIndicator.classList.remove('hidden');
            } else {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Function to show custom alert (replaces alert())
        function showCustomAlert(message) {
            const alertModal = document.createElement('div');
            alertModal.id = 'customAlertModal';
            alertModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]';
            alertModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full mx-4 fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                        <button id="closeCustomAlert" class="text-gray-500 hover:text-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <div class="flex justify-end">
                        <button id="closeCustomAlertBtn" class="btn-primary px-4 py-2 rounded-lg">‡∏ï‡∏Å‡∏•‡∏á</button>
                    </div>
                </div>
            `;
            document.body.appendChild(alertModal);

            const closeAlert = () => {
                document.body.removeChild(alertModal);
            };

            document.getElementById('closeCustomAlert').addEventListener('click', closeAlert);
            document.getElementById('closeCustomAlertBtn').addEventListener('click', closeAlert);
            alertModal.addEventListener('click', (e) => {
                if (e.target === alertModal) {
                    closeAlert();
                }
            });
        }
        
        // Format date to string
        function formatDate(date) {
            if (!date) return '';
            return `${date.getDate()} ${thaiMonths[date.getMonth()]} ${date.getFullYear() + 543}`;
        }
        
        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
